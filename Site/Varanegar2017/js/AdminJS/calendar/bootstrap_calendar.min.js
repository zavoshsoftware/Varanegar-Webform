$.fn.calendar=function(n){var t=$.extend({},$.fn.calendar.defaults,n);return this.each(function(){function d(){var h,c,n,t,f,l,a,s,w;r=$('<table class="daysmonth table table">');y();h=new Date;c=e.val();c!=""&&tt(c)&&(n=c.split("/"),n[2].length==2&&(n[2].charAt(0)=="0"&&(n[2]=n[2].substring(1)),n[2]=parseInt(n[2]),n[2]<50&&(n[2]+=2e3)),h=new Date(n[2],n[1]-1,n[0]));t=h.getMonth();f=h.getFullYear();p(t,f);l=$('<td><i class="fa fa-arrow-right"><\/i><\/td>');l.click(function(n){n.stopPropagation();n.preventDefault();t=(t+1)%12;t==0&&f++;v(t,f)});a=$('<td><i class="fa fa-arrow-left"><\/i><\/td>');a.click(function(n){n.stopPropagation();n.preventDefault();t=t-1;t==-1&&(f--,t=11);v(t,f)});$(".icon-arrow-left").css("cursor","pointer");$(".icon-arrow-right").css("cursor","pointer");s=$('<table class="table header"><tr><\/tr><\/table>');w=$('<td colspan=5 class="year span6"><\/td>');s.append(a);s.append(w);s.append(l);w.append(o);u=$('<div class="calendar" id="'+i+'" ><\/div>');u.prepend(s);u.append(r);e.append(u);b(t,f)}function v(n,t){r.empty();y();p(n,t);b(n,t)}function y(){if(c!=!1){var t=$('<tr class="week_days" >'),n="";$(s).each(function(t,i){n+="<td";t==0&&(n+=' class="first"');t==6&&(n+=' class="last"');n+=">"+i+"<\/td>"});n+="<\/tr>";t.append(n);r.append(t)}}function p(n,t){var e,f,u;o.text(h[n]+" "+t);var s=1,a=g(1,n,t),v=nt(n,t),l=n+1,c="";for(f=0;f<7;f++)f<a?(u="",f==0&&(u+="<tr>"),u+='<td class="invalid',f==0&&(u+=" first"),u+='"><\/td>'):(u="",f==0&&(u+="<tr>"),u+='<td id="'+i+"_"+s+"_"+l+"_"+t+'" ',f==0&&(u+=' class="first"'),f==6&&(u+=' class="last"'),u+="><a>"+s+"<\/a><\/span>",f==6&&(u+="<\/tr>"),s++),c+=u;for(e=1;s<=v;)u="",e%7==1&&(u+="<tr>"),u+='<td id="'+i+"_"+s+"_"+l+"_"+t+'" ',e%7==1&&(u+=' class="first"'),e%7==0&&(u+=' class="last"'),u+="><a>"+s+"<\/a><\/td>",e%7==0&&(u+="<\/tr>"),s++,e++,c+=u;if(e--,e%7!=0)for(u="",f=e%7+1;f<=7;f++)u="",u+='<td class="invalid',f==7&&(u+=" last"),u+='"><\/td>',f==7&&(u+="<\/tr>"),c+=u;r.append(c)}function g(n,t,i){var r=new Date(i,t,n);return r.getDay()}function w(n,t,i){return n>0&&n<13&&i>0&&i<32768&&t>0&&t<=new Date(i,n,0).getDate()}function nt(n,t){for(var i=28;w(n+1,i+1,t);)i++;return i}function tt(n){var t=n.split("/");return t.length!=3?!1:w(t[1],t[0],t[2])}function b(t,i){f!=!1?$.ajax({type:f.type,url:f.url,data:{month:t+1,year:i},dataType:"json"}).done(function(r){n=[];$.each(r,function(t){n.push(r[t])});k(t,i)}):k(t,i)}function k(t,r){for(var f,e=t+1,u=0;u<n.length;u++)n[u][0].split("/")[1]==e&&n[u][0].split("/")[2]==r&&($("#"+i+"_"+n[u][0].replace(/\//g,"_")).addClass("event"),$("#"+i+"_"+n[u][0].replace(/\//g,"_")+" a").attr("data-original-title",n[u][1]),n[u][3]&&(f=$("#"+i+"_"+n[u][0].replace(/\//g,"_")),f.append("<span><\/span>").find("span").css("background",n[u][3])),n[u][2]==""||n[u][2]=="#"?n[u][4]!=""?($("#"+i+"_"+n[u][0].replace(/\//g,"_")+" a").attr("data-trigger","manual"),$("#"+i+"_"+n[u][0].replace(/\//g,"_")+" a").addClass("manual_popover")):$("#"+i+"_"+n[u][0].replace(/\//g,"_")+" a").attr("href","javascript:false;"):$("#"+i+"_"+n[u][0].replace(/\//g,"_")+" a").attr("href",n[u][2]),n[u][4]?($("#"+i+"_"+n[u][0].replace(/\//g,"_")).addClass("event_popover"),$("#"+i+"_"+n[u][0].replace(/\//g,"_")+" a").attr("rel","popover"),$("#"+i+"_"+n[u][0].replace(/\//g,"_")+" a").attr("data-content",n[u][4])):($("#"+i+"_"+n[u][0].replace(/\//g,"_")).addClass("event_tooltip"),$("#"+i+"_"+n[u][0].replace(/\//g,"_")+" a").attr("rel","tooltip")));$("#"+i+" .event_tooltip a").tooltip(a);$("#"+i+" .event_popover a").popover(l);$(".manual_popover").click(function(){$(this).popover("toggle")})}var u,r,o=$('<div class="visualmonthyear"><\/div>'),i="cal_"+Math.floor(Math.random()*99999).toString(36),n=t.events,s,h,c,l,a,f,e;s=typeof t.days!="undefined"?t.days:["S","M","T","W","T","F","S"];h=typeof t.months!="undefined"?t.months:["January","February","March","April","May","June","July","August","September","October","November","December"];c=typeof t.show_days!="undefined"?t.show_days:!0;l=t.popover_options!="undefined"?t.popover_options:{placement:"top"};a=typeof t.tooltip_options!="undefined"?t.tooltip_options:{placement:"top"};f=typeof t.req_ajax!="undefined"?t.req_ajax:!1;e=$(this);d()}),this};